/**
 * Stable Ascyn jQuery Plugin Minify
 * 
 * @author Enmanuel Bisono Payamps <enmanuel0894@gmail.com>
 * @version 2.0
 * @copyright (c) 2016 ITNSoft
 */
!function(t){var e={},a={row:10,pages:10,exclude:[],attributes:[],search:!0,recordPerPage:!0,options:{},orderBy:!0,storage:!0},s=function(a,s){if(a.preventDefault(),e[a.data.id].isBusy())return!1;var i=t(this).text();e[a.data.id].changePage(0,parseInt(i),s)},i=function(t){return t.preventDefault(),e[t.data.id].isBusy()?!1:void e[t.data.id].changePage(1)},r=function(t){return t.preventDefault(),e[t.data.id].isBusy()?!1:void e[t.data.id].changePage(2)},n=function(t){return t.preventDefault(),e[t.data.id].isBusy()?!1:void e[t.data.id].moreAndLessPage(1)},l=function(t){return t.preventDefault(),e[t.data.id].isBusy()?!1:void e[t.data.id].moreAndLessPage(2)},o=function(t){return t.preventDefault(),e[t.data.id].isBusy()?!1:void e[t.data.id].moreAndLessPage(4)},c=function(t){return t.preventDefault(),e[t.data.id].isBusy()?!1:void e[t.data.id].moreAndLessPage(3,1)},_=function(a){return e[a.data.id].isBusy()?!1:void e[a.data.id].setRecordPage(t(this).val())},d=function(a){if(e[a.data.id].isBusy())return!1;var s=a.which;(13===s||""===t(this).val())&&e[a.data.id].searchByCriterion()},h=function(t){return e[t.data.id].isBusy()?!1:void e[t.data.id].searchByCriterion()},u=function(t){return e[t.data.id].isBusy()?!1:void e[t.data.id].searchByCriterion()},E=function(a){return a.preventDefault(),e[a.data.id].isBusy()?!1:void e[a.data.id].setOrderBy(t(this).attr("href"))};t.stable=function(t,e){this.element=t,this.settings=e,this.data=null,this.combo_row=e.row,this.totalrow_cached=0,this.actual_page=1,this.actual_sub_page=0,this.total_pages=0,this.total_sub_page=0,this.orderby={ascDesc:!1,field:null,type:null},this.busy=!1},t.stable.prototype.isBusy=function(){return this.busy},t.stable.prototype.thereAreOptions=function(){return!t.isEmptyObject(this.settings.options)},t.stable.prototype.thereAreAttributes=function(){return this.settings.attributes.length>0?!0:!1},t.stable.prototype.thereAreExcludes=function(){return this.settings.exclude.length>0?!0:!1},t.stable.prototype.getFields=function(){var t=[];if(this.thereAreExcludes())for(var e in this.data.fields)-1===this.settings.exclude.indexOf(this.data.fields[e])&&(t[e]=this.data.fields[e]);else t=this.data.fields;return t},t.stable.prototype.getRows=function(){return this.data.rows},t.stable.prototype.getTotalRows=function(){return this.data.totalrow},t.stable.prototype.getAttributes=function(t){if(!this.thereAreAttributes())return null;var e="";for(var a in t)this.settings.attributes.indexOf(a)>-1&&(e+="data-"+a+'="'+t[a]+'" ');return e.trim()},t.stable.prototype.getNotExcludeField=function(t){if(!this.thereAreExcludes())return t;var e=[];for(var a in t)-1===this.settings.exclude.indexOf(a)&&(e[a]=t[a]);return e},t.stable.prototype.getOptions=function(){return this.settings.options},t.stable.prototype.structure=function(){var t="",e=this.getFields(),a="",s="";for(var i in e)a+='<th><a href="'+i+'" class="STABLE_EVENT_ORDER_BY">'+e[i].replace(/\_/g," ")+"</a></th>",s+='<option value="'+i+'">'+e[i].replace(/\_/g," ")+"</option>";return this.thereAreOptions()&&(a+="<th>Opciones</th>"),t+='<div class="STABLE_STRUCTURE">',t+='<div class="STABLE_FILTERS">',t+='<div class="STABLE_SHOW_RCORDS">',t+="<div>",t+='Record Found: <span class="STABLE_TOTAL_RECORDS">0</span> Showing: ',t+='<select class="STABLE_EVENT_SET_RECORD_PAGE">'+this.getRecordPage()+"</select>",t+="</div>",t+="</div>",t+='<div class="STABLE_SEARCH_RCORDS">',t+="<div>",t+="Search By: ",t+='<select class="STABLE_SELECT_FIELD_FILTER">',t+='<option value="all">All Fields</option>',t+=s,t+="</select>",t+="Criterion: ",t+='<input type="text" class="STABLE_SEARCH_FILTER" />',t+='<button type="button" class="STABLE_SEARCH_BUTTON_FILTER">Search</button>',t+="</div>",t+="</div>",t+="</div>",t+='<div class="STABLE_CLEAR"></div>',t+='<div class="STABLE_PAGINATION">',t+='<div class="STABLE_PAGINATION_INFO">',t+='Page: <span class="STABLE_ACTUAL_PAGE">01</span> of <span class="STABLE_TOTAL_PAGES">1</span>',t+="</div>",t+='<div class="STABLE_PAGINATION_PAGES">',t+="<ul>",t+='<li class="STABLE_EVENT_START_PAGE"><a href="#">Start</a></li>',t+='<li class="STABLE_EVENT_LESS_PAGE"><a href="#">-'+this.settings.pages+"</a></li>",t+='<li class="STABLE_EVENT_PREVIEWS_PAGE"><a href="#">Previews</a></li>',t+='<li class="STABLE_BUTTONS_PAGINATION">',t+='<ul class="STABLE_BUTTONS_PAGINATION"></ul>',t+="</li>",t+='<li class="STABLE_EVENT_NEXT_PAGE"><a href="#">Next</a></li>',t+='<li class="STABLE_EVENT_MORE_PAGE" ><a href="#">+'+this.settings.pages+"</a></li>",t+='<li class="STABLE_EVENT_END_PAGE"><a href="#">End</a></li>',t+="</ul>",t+="</div>",t+="</div>",t+='<div class="STABLE_CLEAR"></div>',t+='<div class="STABLE_CONTENT">',t+="<table>",t+="<thead>",t+="<tr>",t+="<th>#</th>",t+=a,t+="</tr>",t+="</thead>",t+='<tbody class="STABLE_RECORDS">',t+="</tbody>",t+="<tfoot>",t+="<tr>",t+="<th>#</th>",t+=a,t+="</tr>",t+="</tfoot>",t+="</table>",t+="</div>",t+='<div class="STABLE_CLEAR"></div>',t+='<div class="STABLE_PAGINATION">',t+='<div class="STABLE_PAGINATION_INFO">',t+='Page: <span class="STABLE_ACTUAL_PAGE">01</span> of <span class="STABLE_TOTAL_PAGES">1</span>',t+="</div>",t+='<div class="STABLE_PAGINATION_PAGES">',t+="<ul>",t+='<li class="STABLE_EVENT_START_PAGE"><a href="#">Start</a></li>',t+='<li class="STABLE_EVENT_LESS_PAGE"><a href="#">-'+this.settings.pages+"</a></li>",t+='<li class="STABLE_EVENT_PREVIEWS_PAGE"><a href="#">Previews</a></li>',t+="<li>",t+='<ul class="STABLE_BUTTONS_PAGINATION"></ul>',t+="</li>",t+='<li class="STABLE_EVENT_NEXT_PAGE"><a href="#">Next</a></li>',t+='<li class="STABLE_EVENT_MORE_PAGE"><a href="#">+'+this.settings.pages+"</a></li>",t+='<li class="STABLE_EVENT_END_PAGE"><a href="#">End</a></li>',t+="</ul>",t+="</div>",t+="</div>",t+="</div>"},t.stable.prototype.records=function(t,e){var a="",s=this.getNotExcludeField(e);a+="<tr>",a+="<th>"+t+"</th>";for(var i in s)a+="<td>"+s[i]+"</td>";if(this.thereAreOptions()){var r=this.getAttributes(e);a+="<td>";var n=this.getOptions();for(var l in n)a+='<i class="fa '+n[l].icon+" fa-lg STABLE_ACTION_"+l.toUpperCase()+'" title="'+n[l].title+'" '+r+"></i> &nbsp;";a+="</td>"}return a+="</tr>"},t.stable.prototype.pagination=function(t){var e="";return e+='<li class="STABLE_EVENT_PAGINATION">',e+='<a href="#" data-page="'+t+'">'+(10>t?"0"+t:t)+"</a>",e+="</li>"},t.stable.prototype.errorMessage=function(){var t="";return t+='<div class="STABLE_ERROR">',t+="<b>Stable Ascyn</b> no se ha podido cargar correctamente debido a un error inesperado!",t+="</div>"},t.stable.prototype.loadingMessage=function(){var t="";return t+='<div class="STABLE_LOADING">',t+="<b>Stable Ascyn</b> est√° cargando los datos, por favor espere...",t+="</div>"},t.stable.prototype.getDataServer=function(e){var a=this;t.ajax({url:a.settings.url,success:function(t){a.data=t,a.generateContent(),void 0!==e&&e(),a.element.find(".STABLE_LOADING").remove()}})},t.stable.prototype.getDataServerPage=function(e){var a=this;t.ajax({url:a.settings.url,beforeSend:function(){a.busy=!0,a.element.find(".STABLE_CONTENT").prepend(a.loadingMessage())},success:function(t){a.data=t,a.updateContent(),void 0!==e&&e(),a.element.find(".STABLE_LOADING").remove(),a.element.trigger("stable:change"),a.busy=!1}})},t.stable.prototype.generateContent=function(){0===this.totalrow_cached&&(this.totalrow_cached=parseInt(this.getTotalRows()));var t=this.structure();this.element.html(t),this.updateRecords(),this.total_pages=this.generatePage(),this.total_sub_page=this.generatePage(this.total_pages,this.settings.pages),this.generateNumericPaginationButtons(),this.element.find(".STABLE_TOTAL_RECORDS").text(this.data.totalrow),this.element.find(".STABLE_TOTAL_PAGES").text(this.total_pages),this.total_pages<=1&&this.element.find(".STABLE_PAGINATION").hide();var e={id:this.element.attr("id")};this.element.on("click",".STABLE_EVENT_PAGINATION a",e,s),this.element.on("click",".STABLE_EVENT_NEXT_PAGE a",e,i),this.element.on("click",".STABLE_EVENT_PREVIEWS_PAGE a",e,r),this.element.on("click",".STABLE_EVENT_MORE_PAGE a",e,n),this.element.on("click",".STABLE_EVENT_LESS_PAGE a",e,l),this.element.on("click",".STABLE_EVENT_START_PAGE a",e,o),this.element.on("click",".STABLE_EVENT_END_PAGE a",e,c),this.settings.orderBy&&this.element.on("click",".STABLE_EVENT_ORDER_BY",e,E),this.settings.search?(this.element.on("keyup",".STABLE_SEARCH_FILTER",e,d),this.element.on("click",".STABLE_SEARCH_BUTTON_FILTER",e,h),this.element.on("change",".STABLE_SELECT_FIELD_FILTER",e,u)):this.element.find(".STABLE_SEARCH_RCORDS").remove(),this.settings.recordPerPage?this.element.on("change",".STABLE_EVENT_SET_RECORD_PAGE",e,_):this.element.find(".STABLE_SHOW_RCORDS").remove()},t.stable.prototype.updateContent=function(){this.updateRecords()},t.stable.prototype.changeRecords=function(){},t.stable.prototype.setFilter=function(){var e=this.element.find(".STABLE_SEARCH_FILTER").val(),a=this.element.find(".STABLE_SELECT_FIELD_FILTER").val();""===e&&(e=null,a=null),t.ajaxSetup({data:{rows:this.settings.row,page:this.actual_page,field:a,str:e,fieldorder:this.orderby.field,typeorder:this.orderby.type}})},t.stable.prototype.setOrderBy=function(t){this.orderby.ascDesc?(this.orderby.ascDesc=!1,this.orderby.type="DESC"):(this.orderby.ascDesc=!0,this.orderby.type="ASC"),this.orderby.field=t,this.resetPagination()},t.stable.prototype.updateRecords=function(){this.changeRecords();var t=(this.actual_page-1)*this.settings.row,e="";for(var a in this.data.rows)t++,e+=this.records(t,this.data.rows[a]);this.element.find(".STABLE_RECORDS").html(e)},t.stable.prototype.generatePage=function(t,e){var a=void 0===t?parseInt(this.data.totalrow):t,s=void 0===e?parseInt(this.settings.row):e,i=Math.floor(a/s);return i=a%s!==0?i+1:i},t.stable.prototype.getSubActualPage=function(){var t=Math.floor(this.actual_page/this.settings.pages);return this.actual_page%this.settings.pages===0&&t--,t},t.stable.prototype.getRangePagination=function(){if(this.total_pages<=this.settings.pages)return{ini:1,fin:this.total_pages};var t=this.actual_sub_page*this.settings.pages+1,e=(this.actual_sub_page+1)*this.settings.pages;return e=e>this.total_pages?this.total_pages:e,{ini:t,fin:e}},t.stable.prototype.generateNumericPaginationButtons=function(){for(var t=this.getRangePagination(),e="",a=t.ini;a<=t.fin;a++)e+=this.pagination(a);this.element.find(".STABLE_BUTTONS_PAGINATION").html(e),this.element.find(".STABLE_BUTTONS_PAGINATION li a[data-page="+this.actual_page+"]").addClass("active")},t.stable.prototype.updatePagination=function(){this.total_pages=this.generatePage(),this.total_sub_page=this.generatePage(this.total_pages,this.settings.pages),this.generateNumericPaginationButtons(),this.element.find(".STABLE_TOTAL_RECORDS").text(this.data.totalrow),this.element.find(".STABLE_TOTAL_PAGES").text(this.total_pages<10?"0"+this.total_pages:this.total_pages),this.element.find(".STABLE_ACTUAL_PAGE").text(this.actual_page<10?"0"+this.actual_page:this.actual_page),this.total_pages<=1?this.element.find(".STABLE_PAGINATION").hide():this.element.find(".STABLE_PAGINATION").show()},t.stable.prototype.resetPagination=function(){var t=this;this.actual_page=1,this.actual_sub_page=0,this.setFilter(),this.getDataServerPage(function(){t.updatePagination()})},t.stable.prototype.searchByCriterion=function(){this.resetPagination()},t.stable.prototype.updateViewInfoPage=function(){this.element.find(".STABLE_ACTUAL_PAGE").text(this.actual_page<10?"0"+this.actual_page:this.actual_page),this.element.find(".STABLE_EVENT_PAGINATION a").removeClass("active"),this.element.find('.STABLE_EVENT_PAGINATION a[data-page="'+this.actual_page+'"]').addClass("active")},t.stable.prototype.changePage=function(t,e,a){switch(t){case 0:if(this.actual_page===e&&1!==a)return!1;this.actual_page=e;break;case 1:if(!(this.actual_page<this.total_pages))return!1;this.actual_page++;break;case 2:if(!(this.actual_page>1))return!1;this.actual_page--}if(0!==t){var s=this.getSubActualPage();s!==this.actual_sub_page&&(this.actual_sub_page=s,this.generateNumericPaginationButtons())}this.updateViewInfoPage(),this.setFilter(),this.getDataServerPage()},t.stable.prototype.moreAndLessPage=function(t,e){switch(t){case 1:if(!(this.actual_sub_page<this.total_sub_page-1))return!1;this.actual_sub_page++;break;case 2:if(!(this.actual_sub_page>0))return!1;this.actual_sub_page--;break;case 3:if(this.actual_page===this.total_pages)return!1;this.actual_page=this.total_pages,this.actual_sub_page=this.getSubActualPage();break;case 4:if(1===this.actual_page)return!1;this.actual_page=1,this.actual_sub_page=this.getSubActualPage()}this.generateNumericPaginationButtons(),1===e?this.element.find(".STABLE_BUTTONS_PAGINATION li:last-child a").trigger("click",1):this.element.find(".STABLE_BUTTONS_PAGINATION li:first-child a").trigger("click",1)},t.stable.prototype.setRecordPage=function(t){this.settings.row=t,this.resetPagination()},t.stable.prototype.getRecordPage=function(){var t=this.totalrow_cached,e=parseInt(this.combo_row),a="";2e3>=t&&(a+='<option value="'+t+'">All Records</option>');for(var s=e,i=e,r=0;t>=s&&2e3>s;)a+='<option value="'+s+'" '+(s===e?'selected="selected"':"")+">"+s+"</option>",++r<e?s+=i:(s=2*s,i=s,r=0);return a},t.fn.extend({stable:function(s){if(void 0===s.url)return console.error("FATAL ERROR: URL Not Found"),!1;var i=this,r=i.attr("id"),n={};t.extend(n,a,s),t.ajaxSetup({type:"POST",dataType:"json",cache:!1,data:{rows:n.row,page:1},beforeSend:function(){e[r].element.prepend(e[r].loadingMessage())},error:function(t,a,s){e[r].element.html(e[r].errorMessage()),console.error(t.responseText)}}),e[r]=new t.stable(i,n);var l=sessionStorage.getItem("stableData");if(null!==l){var o=JSON.parse(l);r in o&&(t.extend(e[r],o[r].stableObject),e[r].totalrow_cached=parseInt(o[r].stableFilter.totalrow_cached),e[r].setFilter(),t.ajaxSetup({data:{field:o[r].stableFilter.field_search,str:o[r].stableFilter.string_search,rows:o[r].stableFilter.record_per_page}}),e[r].settings.row=o[r].stableFilter.record_per_page)}return e[r].getDataServer(function(){e[r].updateViewInfoPage(),null!==l&&r in o&&(e[r].updatePagination(),e[r].element.find(".STABLE_SEARCH_FILTER").val(o[r].stableFilter.string_search),e[r].element.find(".STABLE_SELECT_FIELD_FILTER").val(o[r].stableFilter.field_search),e[r].element.find(".STABLE_EVENT_SET_RECORD_PAGE").val(o[r].stableFilter.record_per_page)),i.trigger("stable:ready")}),i.on("stable:update",function(){e[r].getDataServerPage()}),this}}),window.onbeforeunload=function(){var t={},a=!1;for(var s in e)e[s].settings.storage&&(t[s]={stableObject:{},stableFilter:{}},t[s].stableObject.actual_page=e[s].actual_page,t[s].stableObject.actual_sub_page=e[s].actual_sub_page,t[s].stableObject.orderby=e[s].orderby,t[s].stableObject.total_pages=e[s].total_pages,t[s].stableObject.total_sub_page=e[s].total_sub_page,t[s].stableFilter.string_search=e[s].element.find(".STABLE_SEARCH_FILTER").val(),t[s].stableFilter.field_search=e[s].element.find(".STABLE_SELECT_FIELD_FILTER").val(),t[s].stableFilter.record_per_page=e[s].element.find(".STABLE_EVENT_SET_RECORD_PAGE").val(),t[s].stableFilter.totalrow_cached=e[s].totalrow_cached,a=!0);a&&sessionStorage.setItem("stableData",JSON.stringify(t))}}(jQuery);